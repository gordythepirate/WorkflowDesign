<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<link rel="stylesheet" href="joint.css" />
<style type="text/css">
	#sHolder .html-element-close
	{
		position: absolute;
		margin-left: 6px;
		background-color: transparent;
		opacity: 0;
		pointer-events: none;
		-webkit-user-select: none;
	}
	#sHolder .html-element-rectangle
	{
		position: absolute;
		margin-left: 7px;
		padding: 0px 0 0px 0;
		background-color: transparent;
		border-radius: 0px;
		pointer-events: none;
		-webkit-user-select: none;
	}
	#dHolder .html-element-close
	{
		position: absolute;
		margin-left: 6px;
		background-color: transparent;
		pointer-events: auto;
		-webkit-user-select: none;
	}
	#dHolder .html-element-rectangle
	{
		position: absolute;
		margin-top: 22px;
		margin-left: 7px;
		padding: 0px 0 40px 0;
		background-color: transparent;
		border-radius: 50px;
		pointer-events: auto;
		-webkit-user-select: none;
	}
</style>

</head>
<title>Workflow Designer</title>
<body>

<!--We have to ensure our paper objects below match up with this div id-->
<div id="sHolder"></div>
<div id="dHolder"></div>

<!--Now we tell the HTML that we're going to start coding in javascript-->
<script src="joint.js"></script>
<script src="joint.shapes.html.js"></script>
<script src="joint.shapes.erd.js"></script>	<!--You can download this source file from the same joint.js site-->
<script type="text/javascript">

// Create a Graph object (and switching to javascript comments)
// This will hold all elements of our workflow including shapes (entities) and connections (links)
var sGraph = new joint.dia.Graph;
var dGraph = new joint.dia.Graph;

// Create a paper object
// A paper is essentially a viewport--this enables us to see our elements on-screen
var sPaper = new joint.dia.Paper({
	el: $('#sHolder'),	// This line has to match up with the div id from above
	width: screen.width,
	height: 120,
	origin: {x: 0, y: 0},
	model: sGraph,		// What Graph object this paper belongs to
	interactive: false
});

var dPaper = new joint.dia.Paper({
	el: $('#dHolder'),
	width: screen.width,
	height: screen.height,
	origin: {x:0, y: 120},
	model: dGraph,
	gridSize: 3
});

// Method: newLink
// Purpose: Creates a link (relationship) between a source element and a target element
function newLink(x, y, label)
{
	var cell = new joint.dia.Link({
		source: {x: x, y: y},
		target: {x: x + 80, y: y}
	});
	return cell;
};

// The following methods create various elements that we can use in our workflow
// The methods create the entity based on a given coordinate position
// If needed, we can tweak these functions to make our default elements smaller/larger/etc
function newRectangle(x, y)
{
	var cell = new joint.shapes.html.Rectangle({
		position: {x: x, y: y},
		size: {width: 80, height: 40}
	});
	return cell;	// Return the entity so we can manipulate it in our code later
};

function newRoundedRectangle(x, y, label)
{
	var cell = new joint.shapes.erd.Entity({
		position: {x: x, y: y},
		size: {width: 80, height: 40},
		attrs: {'.outer': {fill: 'white', stroke: 'black', 'stroke-width': 1, points: '96,0 100,4 100,56 96,60 4,60 0,56 0,4 4,0'},
			'.inner': {fill: 'white', stroke: 'black', 'stroke-width': 1},
			text: {text: label, magnet: true}}
	});
	return cell;
};

function newSquare(x, y, label)
{
	var cell = new joint.shapes.basic.Rect({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newTriangle(x, y, label)
{
	var cell = new joint.shapes.basic.Path({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {path: {d: 'M 0 20 L 20 20 10 0 z'}, text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newDiamond(x, y, label)
{
	var cell = new joint.shapes.basic.Path({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {path: {d: 'M 10 0 L 20 10 10 20 0 10 z'}, text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newCircle(x, y, label)
{
	var cell = new joint.shapes.basic.Circle({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newEllipse(x, y, label)
{
	var cell = new joint.shapes.basic.Circle({
		position: {x: x, y: y},
		size: {width: 80, height: 40},
		attrs: {text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};



/*
function newRoundedRectangle(x, y, label)
{
	var cell = new joint.shapes.erd.Entity({
		position: {x: x, y: y},
		size: {width: 80, height: 40},
		attrs: {'.outer': {fill: 'white', stroke: 'black', 'stroke-width': 1, points: '96,0 100,4 100,56 96,60 4,60 0,56 0,4 4,0'},
			'.inner': {fill: 'white', stroke: 'black', 'stroke-width': 1},
			text: {text: label, magnet: true}}
	});
	return cell;
};

function newSquare(x, y, label)
{
	var cell = new joint.shapes.basic.Rect({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newTriangle(x, y, label)
{
	var cell = new joint.shapes.basic.Path({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {path: {d: 'M 0 20 L 20 20 10 0 z'}, text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newDiamond(x, y, label)
{
	var cell = new joint.shapes.basic.Path({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {path: {d: 'M 10 0 L 20 10 10 20 0 10 z'}, text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newCircle(x, y, label)
{
	var cell = new joint.shapes.basic.Circle({
		position: {x: x, y: y},
		size: {width: 40, height: 40},
		attrs: {text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};

function newEllipse(x, y, label)
{
	var cell = new joint.shapes.basic.Circle({
		position: {x: x, y: y},
		size: {width: 80, height: 40},
		attrs: {text: {text: label, fill: 'black', magnet: true}}
	});
	return cell;
};
*/

// Now we create our actual entities and links (known collectively as cells)
// We can manipulate existing cells later by using their variable name along with functions provided in joint.js
var link = newLink(10, 40, '');
var square = newSquare(100, 20, '');
var rectangle = newRectangle(150, 20);
var roundedRectangle = newRoundedRectangle(240, 20, '');
var circle = newCircle(330, 20, '');
var ellipse = newEllipse(380, 20, '');
var diamond = newDiamond(470, 20, '');
var triangle = newTriangle(520, 20, '');

// Add our entities to the Graph, allowing us to view and manipulate them
sGraph.addCells([link, square, rectangle, roundedRectangle, circle, ellipse, diamond, triangle]);

sPaper.on('cell:pointerclick', function(cellView, evt, x, y)
{	
	var newElement = cellView.model.clone();
	dGraph.addCell(newElement);
	newElement.prop('position/x', 10);
	newElement.prop('position/y', 20);
	newElement.prop('size/width', newElement.prop('size/width') * 2);
	newElement.prop('size/height', newElement.prop('size/height') * 2);
	newElement.prop('inPorts', ['in']);
	newElement.prop('outPorts', ['out']);
	newElement.toBack();
});

dPaper.on('cell:pointerdown', function(cellView, evt, x, y)
{
	cellView.model.toFront();
});

// Remember to close our script tag and HTML tags
</script>
</body>
</html>